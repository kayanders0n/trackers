SET TERM !! ;

CREATE OR ALTER TRIGGER USERS_INSERT FOR USERS
ACTIVE BEFORE INSERT POSITION 0
AS
  DECLARE VARIABLE LISTTYPEID INTEGER;
  DECLARE VARIABLE LISTTYPEDESCRIPT VARCHAR(25);
  DECLARE VARIABLE TYPECODEID INTEGER;
BEGIN
  IF (NEW.FIRSTNAME IS NULL OR TRIM(NEW.FIRSTNAME) = '') THEN EXCEPTION FIELD_REQUIRED 'First Name is required.';
  IF (NEW.LASTNAME IS NULL OR TRIM(NEW.LASTNAME) = '') THEN EXCEPTION FIELD_REQUIRED 'Last Name is required.';
  IF (NEW.USERNAME IS NULL OR TRIM(NEW.USERNAME) = '') THEN EXCEPTION FIELD_REQUIRED 'Username is required.';
  IF (NEW.PASSWORD_HASH IS NULL OR TRIM(NEW.PASSWORD_HASH) = '') THEN EXCEPTION FIELD_REQUIRED 'Password is required.';
  
  IF (NEW.ID IS NULL) THEN NEW.ID = GEN_ID(GEN_USERS_ID,1);
  IF (NEW.EMAIL IS NULL OR TRIM(NEW.EMAIL) = '') THEN NEW.EMAIL = '';
  NEW.CREATEDON = CURRENT_TIMESTAMP;
  NEW.MODIFIEDON = CURRENT_TIMESTAMP;

  FOR SELECT ID, DESCRIPT, TYPEID FROM LISTTYPE WHERE ID > 1 INTO :LISTTYPEID, :LISTTYPEDESCRIPT, :TYPECODEID DO BEGIN
    INSERT INTO USERLIST (USERID, DESCRIPT, TYPEID, LISTTYPEID)
    VALUES (NEW.ID, :LISTTYPEDESCRIPT, :TYPECODEID, :LISTTYPEID);
  END
END
!!

SET TERM ; !!