SET TERM !! ;

CREATE OR ALTER TRIGGER USERLIST_UPDATE FOR USERLIST
ACTIVE BEFORE UPDATE POSITION 0
AS
BEGIN
  IF (NEW.USERID IS DISTINCT FROM OLD.USERID) THEN EXCEPTION GOT_HERE 'Cannot change UserId.';
  IF (NEW.TYPEID IS DISTINCT FROM OLD.TYPEID) THEN EXCEPTION GOT_HERE 'Cannot change Media Type.';
  IF (NEW.LISTTYPEID IS DISTINCT FROM OLD.LISTTYPEID) THEN EXCEPTION GOT_HERE 'Cannot change List Type.';
  IF (NEW.CREATEDON IS DISTINCT FROM OLD.CREATEDON) THEN EXCEPTION GOT_HERE 'Cannot change Created On Date.';

  IF (OLD.LISTTYPEID > 1) THEN BEGIN
    IF (NEW.DESCRIPT IS DISTINCT FROM OLD.DESCRIPT) THEN EXCEPTION GOT_HERE 'Cannot change List Name.';
    IF (NEW.LONGDESCRIPT IS DISTINCT FROM OLD.LONGDESCRIPT) THEN EXCEPTION GOT_HERE 'Cannot change List Description.';
  END
  
  IF (NEW.DESCRIPT IS NULL OR TRIM(NEW.DESCRIPT) = '') THEN EXCEPTION FIELD_REQUIRED 'List Name is required.';

  IF (NEW.OVERRIDE IS NULL) THEN NEW.OVERRIDE = 0;
  IF (NEW.LONGDESCRIPT IS NULL OR TRIM(NEW.LONGDESCRIPT) = '') THEN NEW.LONGDESCRIPT = '';
  IF (NEW.ISPRIVATE IS NULL) THEN NEW.ISPRIVATE = 0;
  NEW.MODIFIEDON = CURRENT_TIMESTAMP;

  
  IF (NEW.OVERRIDE = -999) THEN BEGIN /* User account deleted, allow deletion of default lists */
    DELETE FROM USERLIST WHERE ID = OLD.ID;
    EXIT;
  END ELSE BEGIN /* Reset override */
    NEW.OVERRIDE = 0;
  END
END
!!

SET TERM ; !!